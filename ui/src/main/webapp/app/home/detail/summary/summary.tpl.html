<div class="container-fluid summary-tab" ng-controller="SummaryController">

  <div class="row" ng-if="selectedType === pipelineConstant.PIPELINE && triggeredAlerts.length">
    <div class="col-sm-12 col-md-12 col-lg-12 triggered-alerts"
         ng-repeat="triggeredAlert in triggeredAlerts | filter: {type: 'METRIC_ALERT'}">
      <div class="alert alert-danger" role="alert">
        <i class="fa fa-exclamation-triangle"></i> {{triggeredAlert.rule.alertText}}

        <div class="pull-right">
          <a href="#"
             ng-click="deleteTriggeredAlert(triggeredAlert)">
            <span translate="global.form.delete">Delete</span>
          </a>
          &nbsp;|&nbsp;
          <a href="#"
             ng-click="selectRulesTab(triggeredAlert)">
            <span translate="global.form.changeRule">Change Rule</span>
          </a>
        </div>

      </div>
    </div>
  </div>

  <div class="row">
    <ng-include ng-repeat="(chartIndex, chart) in $storage.summaryChartList" src="chart.templateId">
    </ng-include>
  </div>

</div>


<script type="text/ng-template" id="summaryRecordPercentagePieChartTemplate">
  <div class="col-sm-4"
       ng-if="selectedType === pipelineConstant.STAGE_INSTANCE"
       ng-controller="RecordPercentagePieChartController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.recordsProcessed' | translate}}"
          translate="home.detailPane.summaryTab.recordsProcessed">Records Processed</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <nvd3-pie-chart
          data="pieChartData"
          id="RecordProcessedPieChartID"
          height="250"
          x="getLabel()"
          y="getValue()"
          color="getColor()"
          legendColor="getColor()"
          showLabels="true"
          showLegend="true"
          tooltips="true"
          tooltipcontent="getTooltipContent()"
          labelType="percent"
          donut="true"
          donutRatio=".25"
          donutLabelsOutside="true"
          margin="{left:20,top:20,bottom:20,right:20}">
          <svg></svg>
        </nvd3-pie-chart>
      </div>
    </div>
  </div>
</script>


<script type="text/ng-template" id="summaryRecordCountBarChartTemplate">
  <div class="col-sm-4" ng-controller="RecordCountBarChartController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.recordCountBarChartTitle' | translate}}"
              translate="home.detailPane.summaryTab.recordCountBarChartTitle">Record Count (since last startup)</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <nvd3-discrete-bar-chart
          data="barChartData"
          id="RecordProcessedBarChartID"
          height="250"
          color="getColor()"
          showXAxis="true"
          showYAxis="true"
          showValues="true"
          showLegend="true"
          staggerLabels="true"
          yAxisTickFormat="getYAxisLabel()"
          valueformat="valueFormatFunction()"
          margin="{left:20,top:20,bottom:40,right:20}">
        </nvd3-discrete-bar-chart>
      </div>
    </div>
  </div>
</script>

<script type="text/ng-template" id="summaryRecordsThroughputMeterBarChartTemplate">
  <div class="col-sm-4" ng-controller="MeterBarChartController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.recordThroughput' | translate}}"
              translate="home.detailPane.summaryTab.recordThroughput">Record Throughput</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <nvd3-multi-bar-chart
          data="chartData"
          id="MeterBarChartId"
          height="250"
          color="getColor()"
          legendColor="getColor()"
          yaxislabel="{{'home.detailPane.recordsPerSecond' | translate}}"
          yaxislabeldistance="40"
          yAxisTickFormat="valueFormatFunction()"
          valueformat="valueFormatFunction()"
          margin="{left:50,top:20,bottom:40,right:20}"
          staggerLabels="true"
          showLegend="true"
          showXAxis="true"
          showYAxis="true"
          tooltips="true"
          tooltipcontent="getTooltipContent()">
          <svg></svg>
        </nvd3-multi-bar-chart>
      </div>
    </div>
  </div>

</script>


<script type="text/ng-template" id="summaryBatchThroughputBarChartTemplate">
  <div class="col-sm-4"
       ng-if="selectedType === pipelineConstant.PIPELINE"
       ng-controller="BatchCountBarChartController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.batchThroughput' | translate}}"
          translate="home.detailPane.summaryTab.batchThroughput">Batch Throughput</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <nvd3-discrete-bar-chart
          data="chartData"
          id="BatchCountBarChartID"
          height="250"
          yaxislabel="{{'home.detailPane.batchesPerSecond' | translate}}"
          yaxislabeldistance="40"
          staggerLabels="true"
          showXAxis="true"
          showYAxis="true"
          showValues="false"
          showLegend="true"
          tooltips="true"
          tooltipcontent="getTooltipContent()"
          margin="{left:50,top:20,bottom:40,right:20}">
        </nvd3-discrete-bar-chart>
      </div>
    </div>
  </div>
</script>


<script type="text/ng-template" id="summaryRecordHistogramTemplate">
  <div class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'global.form.histogram' | translate}}"
          translate="global.form.histogram">Record Histogram (5 minutes decay)</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <div ng-controller="HistogramChartController">
          <nvd3-multi-bar-horizontal-chart
            data="timerData"
            id="histogramMixChartID"
            height="250"
            color="getColor()"
            legendColor="getColor()"
            showLegend="true"
            showXAxis="true"
            showYAxis="true"
            showValues="false"
            tooltips="true"
            tooltipcontent="getTooltipContent()"
            margin="{left:65,top:70,bottom:20,right:20}">
            <svg></svg>
          </nvd3-multi-bar-horizontal-chart>
        </div>
      </div>
    </div>
  </div>
</script>


<script type="text/ng-template" id="summaryRecordsProcessedTemplate">
  <div class="col-sm-4"
       ng-controller="BatchTimerChartController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.batchProcessingTimer' | translate}}"
          translate="home.detailPane.summaryTab.batchProcessingTimer">Batch Processing Timer (in seconds)</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <nvd3-multi-bar-horizontal-chart
          data="timerData"
          id="timerDataBatchTimerChartID"
          height="250"
          color="getColor()"
          legendColor="getColor()"
          showLegend="true"
          showXAxis="true"
          showValues="true"
          margin="{left:50,top:70,bottom:20,right:20}">
          <svg></svg>
        </nvd3-multi-bar-horizontal-chart>
      </div>

    </div>
  </div>
</script>

<script type="text/ng-template" id="memoryConsumedLineChartTemplate">
  <div class="col-sm-4"
       ng-if="selectedType === pipelineConstant.STAGE_INSTANCE"
       ng-controller="MemoryConsumedLineChartController">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.memoryConsumed' | translate}}"
          translate="home.detailPane.summaryTab.memoryConsumed">Memory Consumed</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">
        <nvd3-line-chart
          objectequality="true"
          data="lineChartData"
          id="MemoryConsumedLineChartID"
          height="250"
          isArea="false"
          xAxisTickFormat="xAxisTickFormat"
          yAxisTickFormat="yAxisTickFormat"
          showXAxis="true"
          showYAxis="true"
          color="getColor()"
          legendColor="getColor()"
          showLabels="true"
          showLegend="true"
          tooltips="true"
          tooltipcontent="getTooltipContent()"
          margin="{left:50,top:70,bottom:20,right:20}">
          <svg></svg>
        </nvd3-line-chart>
      </div>
    </div>
  </div>
</script>


<script type="text/ng-template" id="summaryRuntimeStatisticsTemplate">
  <div class="col-sm-4"
       ng-if="selectedType === pipelineConstant.PIPELINE">
    <div class="panel panel-default">
      <div class="panel-heading">
        <span title="{{'home.detailPane.summaryTab.runtimeStatistics' | translate}}"
          translate="home.detailPane.summaryTab.runtimeStatistics">Runtime Statistics</span>
        <button type="button" class="close" aria-label="Close" ng-click="removeChart(chart, chartIndex)">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="panel-body">

        <ul class="table-properties">

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.timeOfLastReceivedRecord' | translate}}:</span>
            <span class="properties-value"
                  ng-if="common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.timeOfLastReceivedRecord"
              >{{common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.timeOfLastReceivedRecord  | date:'medium'}}</span>
          </li>

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.batchCount' | translate}}:</span>
            <span class="properties-value">{{common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.batchCount}}</span>
          </li>

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.batchStartTime' | translate}}:</span>
            <span class="properties-value"
                  ng-if="common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.batchStartTime"
              >{{common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.batchStartTime  | date:'medium'}}</span>
          </li>

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.currentBatchAge' | translate}}:</span>
            <span class="properties-value">{{common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.currentBatchAge}}</span>
          </li>

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.currentSourceOffset' | translate}}:</span>
            <span class="properties-value">{{common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.currentSourceOffset}}</span>
          </li>

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.currentStage' | translate}}:</span>
            <span class="properties-value">{{stageNameToLabelMap[common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.currentStage]}}</span>
          </li>

          <li>
            <span class="properties-label">{{'home.detailPane.summaryTab.timeInCurrentStage' | translate}}:</span>
            <span class="properties-value">{{common.pipelineMetrics.gauges['RuntimeStatsGauge.gauge'].value.timeInCurrentStage}}</span>
          </li>

        </ul>

      </div>
    </div>
  </div>
</script>
