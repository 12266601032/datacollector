<div class="panel panel-default snapshot-pane"
     ng-controller="SnapshotController"
     ng-show="snapshotMode">

  <div class="panel-heading clearfix">
    <h3 class="panel-title pull-left">{{'admin.header.snapshot' | translate}}: {{detailPaneConfig.uiInfo.label}} </h3>

    <div class="pull-right size-toolbar">
      <span class="glyphicon pointer"
            ng-hide="maximizeDetailPane"
            ng-class="{'glyphicon-minus' : !minimizeDetailPane , 'glyphicon-resize-full': minimizeDetailPane}"
            ng-click="onMinimizeDetailPane()"></span>
      <span class="glyphicon pointer"
            ng-hide="minimizeDetailPane"
            ng-class="{'glyphicon-fullscreen' : !maximizeDetailPane , 'glyphicon-resize-small': maximizeDetailPane}"
            ng-click="onMaximizeDetailPane()"></span>
    </div>

    <div class="pull-right preview-toolbar">

      <div ng-if="previousStageInstances.length > 1" class="dropdown pull-left">
        <button type="button" class="btn btn-primary btn-sm"
                data-toggle="dropdown">
          <span class="glyphicon glyphicon-arrow-left"></span>
          <span translate="global.form.previousStage">Previous Stage</span>
        </button>
        <ul class="dropdown-menu" role="menu" class="pull-left">
          <li ng-repeat="previousStageInstance in previousStageInstances">
            <a href="#" ng-click="previousStagePreview(previousStageInstance)">
              {{previousStageInstance.uiInfo.label}}
            </a>
          </li>
        </ul>
      </div>

      <div ng-if="previousStageInstances.length <= 1" class="pull-left">
        <button type="button" class="btn btn-primary btn-sm"
                ng-click="previousStagePreview(previousStageInstances[0])"
                ng-disabled="previousStageInstances.length === 0">
          <span class="glyphicon glyphicon-arrow-left"></span>
          <span translate="global.form.previousStage">Previous Stage</span>
        </button>
      </div>

      <div ng-if="nextStageInstances.length > 1" class="dropdown pull-right">
        <button type="button" class="btn btn-primary btn-sm"
                data-toggle="dropdown">
          <span translate="global.form.nextStage">Next Stage</span>
          <span class="glyphicon glyphicon-arrow-right"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li ng-repeat="nextStageInstance in nextStageInstances">
            <a href="#" ng-click="nextStagePreview(nextStageInstance, stagePreviewData.output)">
              {{nextStageInstance.uiInfo.label}}
            </a>
          </li>
        </ul>
      </div>

      <div ng-if="nextStageInstances.length <= 1" class="pull-right">
        <button type="button" class="btn btn-primary btn-sm"
                ng-disabled="nextStageInstances.length === 0"
                ng-click="nextStagePreview(nextStageInstances[0], stagePreviewData.output)">
          <span translate="global.form.nextStage">Next Stage</span>
          <span class="glyphicon glyphicon-arrow-right"></span>
        </button>
      </div>

    </div>


  </div>
  <div class="panel-body">

    <div class="pipeline-preview">

      <table class="table">
        <thead>
        <tr>
          <th class="col-md-6"
              translate="admin.previewPane.inputData">
            Input Data
          </th>

          <th class="col-md-6"
              translate="admin.previewPane.outputData">
            Output Data
          </th>
        </tr>
        </thead>
        <tbody>

        <tr ng-if="detailPaneConfig.uiInfo.stageType === 'SOURCE'"
            ng-repeat="outputRecord in stagePreviewData.output">
          <td>

          </td>
          <td>
            <label class="pointer" ng-click="outputRecord.expand = !outputRecord.expand">
              <span class="glyphicon glyphicon-expand"
                    ng-if="outputRecord.expand !== true"></span>
              <span class="glyphicon glyphicon-collapse-down"
                    ng-if="outputRecord.expand === true"></span>

              {{'global.form.record' | translate}}{{$index+1}}
            </label>
            <ul class="preview-list" ng-if="outputRecord.expand === true">
              <li class="preview-list-item" ng-repeat="(fieldName, recordValue) in outputRecord.values">
                <span class="field-name"> {{fieldName}} : </span>
                <span class="field-value" ng-class="recordValue.type"> {{recordValue.value}} </span>
              </li>
            </ul>
          </td>
        </tr>

        <tr ng-if="detailPaneConfig.uiInfo.stageType === 'PROCESSOR'"
            ng-repeat="inputRecord in stagePreviewData.input">
          <td>
            <label class="pointer" ng-click="inputRecord.expand = !inputRecord.expand">
              <span class="glyphicon glyphicon-expand"
                    ng-if="inputRecord.expand !== true"></span>
              <span class="glyphicon glyphicon-collapse-down"
                    ng-if="inputRecord.expand === true"></span>
              {{'global.form.record' | translate}}{{$index+1}}
              <span class="glyphicon glyphicon-asterisk dirty-icon" ng-if="inputRecord.dirty"></span>
            </label>
            <ul class="preview-list" ng-if="inputRecord.expand === true">
              <li class="preview-list-item"
                  ng-repeat="(fieldName, recordValue) in inputRecord.values"
                  ng-class="{'dirty' : recordValue.dirty}">
                <span class="field-name"> {{fieldName}} : </span>
                <span class="field-value"
                      ng-class="recordValue.dirty ? 'dirty' : recordValue.type"
                      contenteditable="true"
                      ng-change="recordValueUpdated(inputRecord, fieldName, detailPaneConfig)"
                      ng-model="recordValue.value">
                </span>
              </li>
            </ul>
          </td>
          <td>
            <div ng-repeat="outputRecord in outputRecords = getOutputRecords(stagePreviewData.output, inputRecord)">
              <label class="pointer" ng-click="outputRecord.expand = !outputRecord.expand">
                <span class="glyphicon glyphicon-expand"
                      ng-if="outputRecord.expand !== true"></span>
                <span class="glyphicon glyphicon-collapse-down"
                      ng-if="outputRecord.expand === true"></span>
                {{'global.form.record' | translate}}{{$parent.$index+1}} - {{'global.form.outputRecord' | translate}} {{$index + 1}}
              </label>
              <ul class="preview-list" ng-if="outputRecord.expand === true">
                <li class="preview-list-item" ng-repeat="(fieldName, recordValue) in outputRecord.values">
                  <span class="field-name"> {{fieldName}} : </span>
                  <span class="field-value" ng-class="recordValue.type"> {{recordValue.value}} </span>
                </li>
              </ul>
            </div>

            <div ng-repeat="errorRecord in errorsRecords = getErrorRecords(stagePreviewData.errorRecords, inputRecord)">
              <label class="pointer label label-danger" ng-click="errorRecord.expand = !errorRecord.expand">
                <span class="glyphicon glyphicon-expand"
                      ng-if="errorRecord.expand !== true"></span>
                <span class="glyphicon glyphicon-collapse-down"
                      ng-if="errorRecord.expand === true"></span>
                {{'global.form.record' | translate}}{{$parent.$index+1}} - {{'global.form.errorRecord' | translate}} - {{errorRecord.message}}
              </label>
              <ul class="preview-list" ng-if="errorRecord.expand === true">
                <li class="preview-list-item" ng-repeat="(fieldName, recordValue) in errorRecord.record.values">
                  <span class="field-name"> {{fieldName}} : </span>
                  <span class="field-value" ng-class="recordValue.type"> {{recordValue.value}} </span>
                </li>
              </ul>
            </div>

            <div ng-if="outputRecords.length === 0 && errorsRecords.length === 0">
              <label class="label label-warning">{{'admin.previewPane.noOutputWarning' | translate}}</label>
            </div>

          </td>
        </tr>

        <tr ng-if="detailPaneConfig.uiInfo.stageType === 'TARGET'"
            ng-repeat="inputRecord in stagePreviewData.input">
          <td>
            <label class="pointer" ng-click="inputRecord.expand = !inputRecord.expand">
              <span class="glyphicon glyphicon-expand"
                    ng-if="inputRecord.expand !== true"></span>
              <span class="glyphicon glyphicon-collapse-down"
                    ng-if="inputRecord.expand === true"></span>
              {{'global.form.record' | translate}}{{$index+1}}
            </label>
            <ul class="preview-list" ng-if="inputRecord.expand === true">
              <li class="preview-list-item" ng-repeat="(fieldName, recordValue) in inputRecord.values">
                <span class="field-name"> {{fieldName}} : </span>
                <span class="field-value" ng-class="recordValue.type"> {{recordValue.value}} </span>
              </li>
            </ul>
          </td>
          <td>

          </td>
        </tr>

        </tbody>

      </table>

    </div>


  </div>

</div>