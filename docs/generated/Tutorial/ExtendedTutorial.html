
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="The extended tutorial builds on the basic tutorial, using another set of stages to convert the data format from delimited to one that you can write to Elasticsearch. The extended tutorial continues ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="copyright" content="(C) Copyright 2005"></meta><meta name="DC.rights.owner" content="(C) Copyright 2005"></meta><meta name="DC.Type" content="concept"></meta><meta name="DC.Title" content="Extended Tutorial"></meta><meta name="abstract" content="The extended tutorial builds on the basic tutorial, using another set of stages to convert the data format from delimited to one that you can write to Elasticsearch."></meta><meta name="description" content="The extended tutorial builds on the basic tutorial, using another set of stages to convert the data format from delimited to one that you can write to Elasticsearch."></meta><meta name="DC.Relation" scheme="URI" content="../Tutorial/Tutorial-title.html"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="concept_w4n_gjt_ls"></meta><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>Extended Tutorial</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../skin.css"></link><script type="text/javascript"><!--
          
          var prefix = "../index.html";
          
          --></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"><a class="navheader_parent_path" href="../Tutorial/Tutorial-title.html" title="Data Collector Tutorial">Data Collector Tutorial</a></td><td><div class="navheader">
<span class="navparent"><a class="link" href="../Tutorial/Tutorial-title.html" title="Data Collector Tutorial"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Data Collector Tutorial</span></a></span>  </div></td></tr></tbody></table>
<div class="nested0" id="concept_w4n_gjt_ls">
 <h1 class="title topictitle1">Extended Tutorial</h1>

 
 <div class="body conbody"><p class="shortdesc">The extended tutorial builds on the basic tutorial, using another set of stages to
  convert the data format from delimited to one that you can write to Elasticsearch.</p>

  <div class="p">The extended tutorial continues with the following steps:<ol class="ol" id="concept_w4n_gjt_ls__ol_m23_hhk_ps">
    <li class="li">Use a Jython Evaluator to flatten data.</li>

    <li class="li">Convert fields to the appropriate data type.</li>

    <li class="li">Use the Expression Evaluator to merge field data.</li>

    <li class="li">Write the results to Elasticsearch.</li>

   </ol>
</div>

 </div>

<div class="related-links"></div>
<div class="topic task nested1" id="task_cn5_w3k_ps">
    <h2 class="title topictitle2">Flatten Data with a Jython Evaluator</h2>

    
    <div class="body taskbody"><p class="shortdesc">To flatten data from the delimited data record format, let's use a Jython script with
        the Jython Evaluator.</p>

        <div class="section context"></div>

        <ol class="ol steps" id="task_cn5_w3k_ps__steps_s4j_x3k_ps"><li class="li step stepexpand">
                <span class="ph cmd">In the stage library, select the <span class="ph uicontrol">Jython Evaluator</span> and
                    connect the Field Masker and the Expression Evaluator to the stage, as
                    shown:</span>
                <div class="itemgroup info"><img class="image" id="task_cn5_w3k_ps__image_fsy_3nk_ps" src="../Graphics/Tutorial-Jython2pipeline.png" height="145" width="593"></img></div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">On the <span class="ph uicontrol">Jython</span> tab, delete everything in the Script field
                    and enter the following script:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock">try:
  for record in records:
    flattened = dict((field['header'].strip(), field['value'] if field['value'] != '' else None) for field in record.value)
    record.value = flattened
    out.write(record)
except Exception as e:
  err.write(record, e.message)  </pre>

                    <div class="note note"><span class="notetitle">Note:</span> Incorrect indentation can cause
                  Jython validation errors. For best results, copy the script from the online help.
                  Copying the script from the User Guide PDF can cause incorrect indentation. </div>

                </div>
            </li>
</ol>

    </div>

</div>
<div class="topic task nested1" id="task_kxl_tvk_ps">
    <h2 class="title topictitle2">Convert Types with a Field Converter</h2>

    
    <div class="body taskbody"><p class="shortdesc">Now that data is flattened, you can use a Field Converter to convert the data types
        of the flattened fields. Let's convert the appropriate fields to Datetime and Double. Any
        field that you don't convert remains a String field. </p>

        <div class="section context"></div>

        <ol class="ol steps" id="task_kxl_tvk_ps__steps_wx1_xvk_ps"><li class="li step stepexpand">
                <span class="ph cmd">From the stage library, select the <span class="ph uicontrol">Field Converter</span>
                    processor and connect it to the Jython Evaluator. Or, from the Pipeline Creation
                    Help Bar, click <span class="ph menucascade"><span class="ph uicontrol">Select Processor to Connect</span> &gt; <span class="ph uicontrol">Field Converter</span></span>.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="ph uicontrol">Conversions</span> tab.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Convert fields with datetime data to Datetime as follows:</span>
                <div class="itemgroup info">
                    <table cellpadding="4" cellspacing="0" summary="" id="task_kxl_tvk_ps__simpletable_sp4_wxk_ps" border="1" class="simpletable"><tr class="sthead">
                            <th valign="bottom" align="left" id="d48549e149" class="stentry">Field Converter Property</th>

                            <th valign="bottom" align="left" id="d48549e152" class="stentry">Datetime Conversion</th>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d48549e149" class="stentry">Fields to Convert</td>

                            <td valign="top" headers="d48549e152" class="stentry">Click in the field and select the following fields:<ul class="ul" id="task_kxl_tvk_ps__ul_wnn_zxk_ps">
                                    <li class="li">/dropoff_datetime</li>

                                    <li class="li">/pickup_datetime</li>

                                </ul>
</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d48549e149" class="stentry">Convert to Type</td>

                            <td valign="top" headers="d48549e152" class="stentry">Datetime</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d48549e149" class="stentry">Date Format</td>

                            <td valign="top" headers="d48549e152" class="stentry">YYYY-MM-DD hh:mm:ss</td>

                        </tr>
</table>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To convert fields to Double, click the <span class="ph uicontrol">Add</span> icon and
                    configure the properties as follows:</span>
                <div class="itemgroup info">
                    <table cellpadding="4" cellspacing="0" summary="" id="task_kxl_tvk_ps__simpletable_tcl_dyk_ps" border="1" class="simpletable"><tr class="sthead">
                            <th valign="bottom" align="left" id="d48549e210" class="stentry">Field Converter Property</th>

                            <th valign="bottom" align="left" id="d48549e213" class="stentry">Double Conversion</th>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d48549e210" class="stentry">Fields to Convert</td>

                            <td valign="top" headers="d48549e213" class="stentry">Click in the field and select the following fields:<ul class="ul" id="task_kxl_tvk_ps__ul_mly_gyk_ps">
                                    <li class="li">/fare_amount</li>

                                    <li class="li">/mta_tax</li>

                                    <li class="li">/pickup_latitude</li>

                                    <li class="li">/pickup_longitude</li>

                                    <li class="li">/surcharge</li>

                                    <li class="li">/tip_amount</li>

                                    <li class="li">/tolls_amount</li>

                                    <li class="li">/total_amount</li>

                                </ul>
</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d48549e210" class="stentry">Convert to Type</td>

                            <td valign="top" headers="d48549e213" class="stentry">Double</td>

                        </tr>
</table>

                </div>
            </li>
</ol>

        <div class="section result">The pipeline and Field Converter should look like this:<img class="image" id="task_kxl_tvk_ps__image_lhs_bjq_ps" src="../Graphics/Tutorial-FieldConverter.png" height="360" width="762"></img></div>

    </div>

</div>
<div class="topic task nested1" id="task_rlk_tdq_ps">
    <h2 class="title topictitle2">Merge Field Data with the Expression Evaluator</h2>

    
    <div class="body taskbody"><p class="shortdesc">Before writing data to Elasticsearch, let's merge the longitude and latitude
        information into a single pickup location field. </p>

        <div class="section context">
            <p class="p"></p>

        </div>

        <div class="li step p">
                <span class="ph cmd">Add an <span class="ph uicontrol">Expression Evaluator </span>to the canvas and connect it
                    to the <span class="ph uicontrol">Field Converter</span>.</span>
            </div>

    </div>

</div>
</div>
<div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../Tutorial/Tutorial-title.html" title="Data Collector Tutorial"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Data Collector Tutorial</span></a></span>  </div><div class="footer"><div> </div><!-- © <a href="http://creativecommons.org/licenses/by-nc/4.0/legalcode">CC BY-NC 4.0.</a> StreamSets, 2015. --></div>
</body>
</html>